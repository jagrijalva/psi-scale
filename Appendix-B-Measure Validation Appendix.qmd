---
title: "Appendix B: Measure Validation"
subtitle: "Power-Sharing Index Methodological Documentation"
author: "Jessa M. Agricola"
date: today
format:
  pdf:
    toc: true
    toc-depth: 3
    number-sections: true
    fig-width: 8
    fig-height: 5
execute:
  echo: true
  warning: false
  message: false
editor: visual
---

```{r}
#| label: setup
#| echo: false

if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, gt, scales, psych, ggcorrplot, knitr)

vdem <- readRDS("/Users/jessalagrijalva/Desktop/In_Progress/Github/Herrenvolk/data/V-Dem-CY-Full+Others-v15.rds")

usa <- vdem |>
  filter(country_name == "United States of America") |>
  arrange(year) |>
  select(
    year, country_name,
    v2pepwrsoc, v2pepwrgen, v2clsocgrp, v2cltort, v2clkill,
    v2peapssoc, v2x_suffr, v2clpolcl,
    v2x_polyarchy, v2x_libdem, v2x_partipdem
  )

normalize_minmax <- function(x) {
  rng <- range(x, na.rm = TRUE)
  (x - rng[1]) / (rng[2] - rng[1])
}

eps <- 0.001

usa_psi <- usa |>
  mutate(
    across(c(v2pepwrsoc, v2pepwrgen, v2clsocgrp, v2cltort, v2clkill),
           normalize_minmax, .names = "{.col}_norm"),
    polyarchy_norm = normalize_minmax(v2x_polyarchy),
    psi_additive = (v2pepwrsoc_norm + v2pepwrgen_norm + v2clsocgrp_norm +
                    v2cltort_norm + v2clkill_norm) / 5,
    psi_multiplicative = (pmax(v2pepwrsoc_norm, eps) * pmax(v2pepwrgen_norm, eps) *
                          pmax(v2clsocgrp_norm, eps) * pmax(v2cltort_norm, eps) *
                          pmax(v2clkill_norm, eps))^(1/5),
    psi_hybrid = polyarchy_norm * psi_multiplicative
  )

safe_cor <- function(x, y) {
  complete <- complete.cases(x, y)
  if (sum(complete) < 3) return(NA_real_)
  cor(x[complete], y[complete])
}
```

\newpage

# Introduction

This appendix documents the validation of the Power-Sharing Index (PSI), demonstrating that it is a properly constructed, internally consistent, and conceptually valid measure. Validation is presented in five sections:

1.  **Variable Selection**: Criteria for choosing PSI components
2.  **Internal Consistency**: Whether components measure a coherent construct
3.  **Dimensionality**: Whether components load onto a single factor
4.  **Convergent & Discriminant Validity**: Relationship to existing V-Dem indices
5.  **Uncertainty Quantification**: Measurement precision

## Conceptual Foundation

PSI measures whether political power can transfer across demographic boundaries. It operationalizes five mechanisms through which power monopolization operates:

| Dimension | V-Dem Variable | What It Captures |
|----|----|----|
| Social Group Power | v2pepwrsoc | Can power cross racial/ethnic/religious lines? |
| Gender Power | v2pepwrgen | Can power cross gender lines? |
| Civil Liberties Equality | v2clsocgrp | Do rights apply equally across groups? |
| Freedom from Torture | v2cltort | Is state coercion used against groups? |
| Freedom from Killings | v2clkill | Is extreme violence used for control? |

\newpage

# Variable Selection

## Selection Criteria

Variables were evaluated on four criteria:

1.  **Temporal Coverage**: Data available from 1789 to capture the full historical range
2.  **Conceptual Fit**: Measures cross-group power distribution, not intra-group procedures
3.  **Face Validity**: Scores should be LOW during periods of known exclusion
4.  **Non-Redundancy**: Each component captures a distinct aspect of power-sharing

Note: Unlike Sigman and Lindberg (2019), I do not exclude variables because they appear in existing V-Dem indices. This concern does not apply here because PSI measures a conceptually distinct phenomenon. Whether components overlap with existing indices is an empirical question addressed in the discriminant validity analysis below.

## Step 1: Temporal Coverage

```{r}
#| label: temporal-check

temporal <- usa |>
  summarise(
    v2pepwrsoc = min(year[!is.na(v2pepwrsoc)]),
    v2pepwrgen = min(year[!is.na(v2pepwrgen)]),
    v2peapssoc = min(year[!is.na(v2peapssoc)]),
    v2clsocgrp = min(year[!is.na(v2clsocgrp)]),
    v2cltort = min(year[!is.na(v2cltort)]),
    v2clkill = min(year[!is.na(v2clkill)]),
    v2x_suffr = min(year[!is.na(v2x_suffr)]),
    v2clpolcl = min(year[!is.na(v2clpolcl)])
  ) |>
  pivot_longer(everything(), names_to = "Variable", values_to = "First_Year") |>
  mutate(
    Coverage = if_else(First_Year <= 1789, "Full (1789+)", paste0("Partial (", First_Year, ")")),
    Decision = if_else(First_Year <= 1789, "KEEP", "EXCLUDE")
  )

temporal |>
  gt() |>
  tab_header(
    title = "Temporal Coverage Check",
    subtitle = "Require data from 1789 to capture full historical range"
  ) |>
  tab_style(
    style = cell_fill(color = "lightgreen"),
    locations = cells_body(rows = Decision == "KEEP")
  ) |>
  tab_style(
    style = cell_fill(color = "lightcoral"),
    locations = cells_body(rows = Decision == "EXCLUDE")
  )
```

**Excluded**: v2peapssoc, v2clpolcl (begin 1900, missing 111 years of critical historical variation)

## Step 2: Conceptual Fit

Variables must measure cross-group power distribution, not intra-group procedures. The critical test: scores should be LOW during periods of known exclusion (the Herrenvolk era, 1789-1899).

```{r}
#| label: conceptual-fit

herrenvolk_means <- usa |>
  filter(year <= 1899) |>
  summarise(
    v2pepwrsoc = mean(v2pepwrsoc, na.rm = TRUE),
    v2pepwrgen = mean(v2pepwrgen, na.rm = TRUE),
    v2clsocgrp = mean(v2clsocgrp, na.rm = TRUE),
    v2cltort = mean(v2cltort, na.rm = TRUE),
    v2clkill = mean(v2clkill, na.rm = TRUE),
    v2x_suffr = mean(v2x_suffr, na.rm = TRUE)
  ) |>
  pivot_longer(everything(), names_to = "Variable", values_to = "Mean_1789_1899")

conceptual <- herrenvolk_means |>
  mutate(
    Interpretation = case_when(
      Variable == "v2x_suffr" ~ "HIGH: White men had suffrage; measures intra-group participation",
      TRUE ~ "LOW: Captures exclusion as expected"
    ),
    Decision = if_else(Variable == "v2x_suffr", "EXCLUDE", "KEEP")
  )

conceptual |>
  gt() |>
  tab_header(
    title = "Conceptual Fit: Herrenvolk Era Means (1789-1899)",
    subtitle = "Variables should score LOW during known exclusion"
  ) |>
  fmt_number(columns = Mean_1789_1899, decimals = 3) |>
  tab_style(
    style = cell_fill(color = "lightgreen"),
    locations = cells_body(rows = Decision == "KEEP")
  ) |>
  tab_style(
    style = cell_fill(color = "lightcoral"),
    locations = cells_body(rows = Decision == "EXCLUDE")
  )
```

**Excluded**: v2x_suffr (suffrage) scores HIGH during the Herrenvolk era because it measures whether *any* citizens can vote, not whether *all* groups can vote. White men had suffrage; the procedural requirement was met even as power remained monopolized.

## Final Components

```{r}
#| label: final-components

tribble(
  ~Component, ~Variable, ~Description,
  "Social Group Power", "v2pepwrsoc", "Political power distributed across racial, ethnic, religious groups",
  "Gender Power", "v2pepwrgen", "Political power distributed between men and women",
  "Civil Liberties Equality", "v2clsocgrp", "Equal civil liberties across social groups",
  "Freedom from Torture", "v2cltort", "Freedom from government torture",
  "Freedom from Killings", "v2clkill", "Freedom from political killings"
) |>
  gt() |>
  tab_header(title = "Final PSI Components")
```

\newpage

# Internal Consistency

Internal consistency assesses whether the five components measure a coherent underlying construct.

## Inter-Item Correlations

```{r}
#| label: correlations
#| fig-height: 5

cor_data <- usa_psi |>
  select(v2pepwrsoc_norm, v2pepwrgen_norm, v2clsocgrp_norm, v2cltort_norm, v2clkill_norm) |>
  drop_na()

cor_matrix <- cor(cor_data)
colnames(cor_matrix) <- c("SocGrp", "Gender", "CivLib", "Torture", "Killing")
rownames(cor_matrix) <- colnames(cor_matrix)

ggcorrplot(cor_matrix, type = "lower", lab = TRUE, lab_size = 4,
           colors = c("#6D9EC1", "white", "#E46726"),
           title = "Inter-Item Correlations")
```

All inter-item correlations exceed 0.60, indicating strong relationships among components.

## Cronbach's Alpha

```{r}
#| label: cronbach

alpha_result <- psych::alpha(cor_data, check.keys = TRUE)

tibble(
  Metric = c("Raw Alpha", "Standardized Alpha", "Average Inter-Item r"),
  Value = c(alpha_result$total$raw_alpha, alpha_result$total$std.alpha, alpha_result$total$average_r)
) |>
  gt() |>
  tab_header(
    title = "Internal Consistency",
    subtitle = "Alpha > 0.80 indicates excellent reliability"
  ) |>
  fmt_number(columns = Value, decimals = 3)
```

Cronbach's α = 0.96 indicates excellent internal consistency. The components reliably measure a coherent underlying construct.

## Alpha if Item Dropped

```{r}
#| label: alpha-drop

alpha_result$alpha.drop |>
  as.data.frame() |>
  rownames_to_column("Component") |>
  mutate(Component = case_when(
    str_detect(Component, "pepwrsoc") ~ "Social Group Power",
    str_detect(Component, "pepwrgen") ~ "Gender Power",
    str_detect(Component, "clsocgrp") ~ "Civil Liberties",
    str_detect(Component, "cltort") ~ "Torture Freedom",
    str_detect(Component, "clkill") ~ "Killing Freedom"
  )) |>
  select(Component, raw_alpha, std.alpha) |>
  gt() |>
  tab_header(
    title = "Alpha if Item Dropped",
    subtitle = "If alpha increases when dropped, item may not belong"
  ) |>
  fmt_number(columns = c(raw_alpha, std.alpha), decimals = 3)
```

No component substantially increases alpha when dropped, confirming that all five belong in the index.

\newpage

# Dimensionality

Dimensionality analysis assesses whether the components load onto a single underlying factor.

## Principal Components Analysis

```{r}
#| label: pca

pca_result <- prcomp(cor_data, scale. = TRUE)
var_explained <- summary(pca_result)$importance[2, ] * 100

tibble(
  PC = 1:5, 
  `Variance Explained (%)` = var_explained, 
  `Cumulative (%)` = cumsum(var_explained)
) |>
  gt() |>
  tab_header(
    title = "PCA Variance Explained",
    subtitle = "PC1 > 50% indicates unidimensional construct"
  ) |>
  fmt_number(columns = c(`Variance Explained (%)`, `Cumulative (%)`), decimals = 1)
```

PC1 explains 87.4% of variance, far exceeding the 50% threshold for unidimensionality. The five components measure a single underlying construct.

## Scree Plot

```{r}
#| label: scree
#| fig-height: 4

tibble(PC = 1:5, Variance = var_explained) |>
  ggplot(aes(x = PC, y = Variance)) +
  geom_col(fill = "steelblue", alpha = 0.8) +
  geom_line(linewidth = 1) +
  geom_point(size = 3) +
  geom_hline(yintercept = 20, linetype = "dashed", color = "red") +
  scale_y_continuous(limits = c(0, 100), labels = \(x) paste0(x, "%")) +
  labs(title = "Scree Plot", 
       subtitle = "Red line = equal variance (20%). Clear 'elbow' at PC1.",
       x = "Principal Component", y = "Variance Explained") +
  theme_minimal()
```

## PCA Loadings

```{r}
#| label: loadings

pca_result$rotation |>
  as.data.frame() |>
  rownames_to_column("Variable") |>
  mutate(Variable = case_when(
    str_detect(Variable, "pepwrsoc") ~ "Social Group Power",
    str_detect(Variable, "pepwrgen") ~ "Gender Power",
    str_detect(Variable, "clsocgrp") ~ "Civil Liberties",
    str_detect(Variable, "cltort") ~ "Torture Freedom",
    str_detect(Variable, "clkill") ~ "Killing Freedom"
  )) |>
  select(Variable, PC1, PC2) |>
  gt() |>
  tab_header(
    title = "PCA Loadings",
    subtitle = "All components load strongly on PC1"
  ) |>
  fmt_number(columns = c(PC1, PC2), decimals = 3)
```

All five components load strongly (\> 0.38) on PC1, confirming unidimensionality.

## Kaiser-Meyer-Olkin Test

```{r}
#| label: kmo

kmo_result <- psych::KMO(cor_data)

tibble(
  Item = c("Overall MSA", "Social Group Power", "Gender Power", 
           "Civil Liberties", "Torture Freedom", "Killing Freedom"),
  KMO = c(kmo_result$MSA, kmo_result$MSAi)
) |>
  gt() |>
  tab_header(
    title = "Kaiser-Meyer-Olkin Test",
    subtitle = "KMO > 0.60 indicates adequate sampling for factor analysis"
  ) |>
  fmt_number(columns = KMO, decimals = 3)
```

Overall KMO = 0.79 ("meritorious") indicates the data are well-suited for factor analysis.

\newpage

# Convergent and Discriminant Validity

Convergent validity asks: Does PSI correlate with measures it *should* correlate with?

Discriminant validity asks: Does PSI *diverge* from measures of different constructs?

## The Critical Test: Divergence During the Herrenvolk Era

If PSI measures cross-group power-sharing and V-Dem indices measure procedural democracy, they should *diverge* during periods when procedures existed for some groups but power was monopolized.

```{r}
#| label: era-corr

usa_psi |>
  mutate(period = case_when(
    year < 1900 ~ "Herrenvolk (1789-1899)",
    year < 1965 ~ "Jim Crow (1900-1964)",
    TRUE ~ "Post-Civil Rights (1965+)"
  ) |> factor(levels = c("Herrenvolk (1789-1899)", "Jim Crow (1900-1964)", "Post-Civil Rights (1965+)"))) |>
  group_by(period) |>
  summarise(
    N = n(),
    `r(PSI, Electoral)` = safe_cor(psi_additive, v2x_polyarchy),
    `r(PSI, Liberal)` = safe_cor(psi_additive, v2x_libdem),
    `r(PSI, Participatory)` = safe_cor(psi_additive, v2x_partipdem),
    .groups = "drop"
  ) |>
  gt() |>
  tab_header(
    title = "Era-Specific Correlations: PSI vs. V-Dem Indices",
    subtitle = "Discriminant validity: PSI should diverge from Electoral Democracy during Herrenvolk era"
  ) |>
  fmt_number(columns = -c(period, N), decimals = 3) |>
  tab_footnote(
    footnote = "Egalitarian and Deliberative indices excluded; they begin in 1900."
  )
```

**Key finding**: During the Herrenvolk era (1789-1899), PSI shows a *negative* correlation with Electoral Democracy (r = -0.25). This is the discriminant validity test: as procedural democracy expanded among white men, cross-group power-sharing did *not* increase.

## The Herrenvolk Paradox (Visualization)

```{r}
#| label: herrenvolk-paradox
#| fig-height: 5

herrenvolk <- usa_psi |> filter(year <= 1899)
r_value <- cor(herrenvolk$v2x_polyarchy, herrenvolk$psi_additive, use = "complete.obs")

ggplot(herrenvolk, aes(x = year)) +
  geom_line(aes(y = v2x_polyarchy, color = "Electoral Democracy (V-Dem)"), linewidth = 1.2) +
  geom_line(aes(y = psi_additive, color = "Power-Sharing Index"), linewidth = 1.2) +
  geom_smooth(aes(y = v2x_polyarchy), method = "lm", se = FALSE, 
              color = "#fdae61", linetype = "dashed", linewidth = 0.5) +
  geom_smooth(aes(y = psi_additive), method = "lm", se = FALSE,
              color = "#2c7bb6", linetype = "dashed", linewidth = 0.5) +
  annotate("text", x = 1810, y = 0.55, hjust = 0, fontface = "bold",
           label = paste0("r = ", round(r_value, 3), "\n\nElectoral Democracy rises\nwhile PSI stays flat")) +
  scale_color_manual(values = c("Electoral Democracy (V-Dem)" = "#fdae61", "Power-Sharing Index" = "#2c7bb6")) +
  scale_y_continuous(limits = c(0, 0.6)) +
  labs(title = "The Herrenvolk Paradox (1789-1899)",
       subtitle = "Procedural democracy expanded among white men while power remained monopolized",
       x = NULL, y = "Index Value", color = NULL) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

This divergence demonstrates that PSI measures something qualitatively different from existing V-Dem indices. It is not redundant with Electoral, Liberal, or Participatory democracy measures.

## Full-Series Correlations

```{r}
#| label: full-corr

usa_psi |>
  summarise(
    Electoral = cor(psi_additive, v2x_polyarchy, use = "complete.obs"),
    Liberal = cor(psi_additive, v2x_libdem, use = "complete.obs"),
    Participatory = cor(psi_additive, v2x_partipdem, use = "complete.obs")
  ) |>
  pivot_longer(everything(), names_to = "V-Dem Index", values_to = "Correlation") |>
  gt() |>
  tab_header(
    title = "Full-Series Correlations (1789-2024)",
    subtitle = "Indices with full temporal coverage"
  ) |>
  fmt_number(columns = Correlation, decimals = 3) |>
  tab_footnote(
    footnote = "High full-series correlations are expected because both PSI and V-Dem improve after 1965. Era-specific correlations (above) provide the discriminant test."
  )
```

\newpage

# Uncertainty Quantification

## Within-Era Variation

```{r}
#| label: uncertainty

usa_psi |>
  mutate(period = case_when(
    year < 1900 ~ "Herrenvolk (1789-1899)",
    year < 1965 ~ "Jim Crow (1900-1964)",
    TRUE ~ "Post-Civil Rights (1965+)"
  ) |> factor(levels = c("Herrenvolk (1789-1899)", "Jim Crow (1900-1964)", "Post-Civil Rights (1965+)"))) |>
  group_by(period) |>
  summarise(
    N = n(),
    Mean = mean(psi_additive, na.rm = TRUE),
    SD = sd(psi_additive, na.rm = TRUE),
    SE = SD / sqrt(N),
    CI_Lower = Mean - 1.96 * SE,
    CI_Upper = Mean + 1.96 * SE,
    .groups = "drop"
  ) |>
  gt() |>
  tab_header(
    title = "PSI Uncertainty by Era",
    subtitle = "95% confidence intervals from within-era variation"
  ) |>
  fmt_number(columns = -c(period, N), decimals = 3)
```

Confidence intervals are narrow and do not overlap across eras, indicating that era differences are statistically meaningful.

## Decade-Level Precision

```{r}
#| label: decade-ci
#| fig-height: 5

decade_summary <- usa_psi |>
  mutate(decade = floor(year / 10) * 10) |>
  group_by(decade) |>
  summarise(
    year_mid = median(year),
    mean = mean(psi_additive, na.rm = TRUE),
    se = sd(psi_additive, na.rm = TRUE) / sqrt(n()),
    ci_lo = pmax(0, mean - 1.96 * se),
    ci_hi = pmin(1, mean + 1.96 * se),
    .groups = "drop"
  )

ggplot() +
  geom_ribbon(data = decade_summary, aes(x = year_mid, ymin = ci_lo, ymax = ci_hi),
              fill = "steelblue", alpha = 0.3) +
  geom_line(data = usa_psi, aes(x = year, y = psi_additive), linewidth = 0.8) +
  geom_point(data = decade_summary, aes(x = year_mid, y = mean), color = "darkblue", size = 2) +
  scale_y_continuous(limits = c(0, 1), labels = percent) +
  labs(title = "PSI with 95% Confidence Intervals",
       subtitle = "Uncertainty from within-decade variation",
       x = NULL, y = "Power-Sharing Index") +
  theme_minimal()
```

\newpage

# Validation Summary

```{r}
#| label: checklist

tribble(
  ~Category, ~Test, ~Result, ~Interpretation,
  "Variable Selection", "Temporal coverage (1789+)", "5 of 8 pass", "Full historical range",
  "Variable Selection", "Conceptual fit (low during exclusion)", "5 of 6 pass", "Measures cross-group power",
  "Internal Consistency", "Cronbach's Alpha > 0.80", "α = 0.96", "Excellent reliability",
  "Internal Consistency", "All inter-item r > 0.60", "Yes", "Coherent construct",
  "Dimensionality", "PC1 > 50% variance", "87.4%", "Unidimensional",
  "Dimensionality", "KMO > 0.60", "0.79", "Adequate sampling",
  "Discriminant Validity", "Herrenvolk r(PSI, Electoral) ≠ high positive", "r = -0.25", "Measures distinct construct",
  "Convergent Validity", "Post-1965 r(PSI, V-Dem) > 0.80", "r > 0.84", "Converges when expected"
) |>
  gt() |>
  tab_header(
    title = "Validation Checklist",
    subtitle = "All tests passed"
  )
```

## Conclusion

The Power-Sharing Index demonstrates:

1.  **Proper construction**: Components selected through transparent, replicable criteria
2.  **Internal consistency**: α = 0.96 indicates excellent reliability
3.  **Unidimensionality**: 87.4% variance on PC1 confirms single-factor structure
4.  **Discriminant validity**: Negative correlation with Electoral Democracy during Herrenvolk era proves PSI measures a distinct construct
5.  **Convergent validity**: High correlations with V-Dem after 1965 when constructs should align
6.  **Adequate precision**: Narrow confidence intervals, era differences statistically meaningful

PSI is a valid, reliable measure of cross-group power-sharing that captures variation missed by existing procedural democracy indices.

\newpage

# Session Info

```{r}
#| label: session
#| echo: false

sessionInfo()
```
